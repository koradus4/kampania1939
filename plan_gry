Rozpoczynam dokÅ‚adnÄ… analizÄ™ Twojego projektu gry z archiwum `kampania_wrzesniowa_1939 (4).zip`. SkupiÄ™ siÄ™ na integracji systemu ekonomii, zaopatrzenia, baz, losowych zdarzeÅ„, wsparcia sojusznikÃ³w, pogody, edytorÃ³w mapy i Å¼etonÃ³w oraz logiki punktÃ³w ekonomicznych. PrzygotujÄ™ zoptymalizowane rozwiÄ…zania, ktÃ³re moÅ¼na od razu wÅ‚Ä…czyÄ‡ do pliku `plan_gry.md`, w tym tabele wartoÅ›ci domyÅ›lnych i sugestie modyfikacji moduÅ‚Ã³w.

# Plan integracji systemu ekonomii, zaopatrzenia i powiÄ…zanych mechanik

## Analiza stanu obecnego

### System ekonomii i zaopatrzenia (PE/PZ)
Aktualnie gra posiada klasÄ™ `EconomySystem` obsÅ‚ugujÄ…cÄ… ekonomiÄ™. Dla kaÅ¼dej nacji przechowywane sÄ… **Punkty Ekonomiczne (PE)** i **Punkty Zaopatrzenia (PZ)**. Na start Polska ma 1000 PE i 500 PZ, zaÅ› Niemcy 2000 PE i 1000 PZ. Klasa udostÄ™pnia metody do modyfikacji tych wartoÅ›ci, dodawania przychodu i wydatkÃ³w, konwersji punktÃ³w ekonomicznych na zaopatrzenie oraz resetowania stanu. 

- **Punkty ekonomiczne (PE):** SÅ‚uÅ¼Ä… jako zasoby produkcyjne/finansowe. Obecne metody pozwalajÄ… dodawaÄ‡ przychÃ³d (`add_income`) oraz odejmowaÄ‡ wydatki (`add_expense` i `spend_economic_points`). W kodzie nie ma jeszcze automatycznego wykorzystania tych metod podczas rozgrywki â€“ sÄ… wywoÅ‚ywane tylko w testach. Brak jest teÅ¼ ograniczeÅ„ poza globalnym maksimum 5000 PE.
- **Punkty zaopatrzenia (PZ):** ReprezentujÄ… zasoby logistyczne potrzebne do utrzymania jednostek. Analogicznie, moÅ¼na je modyfikowaÄ‡ metodami (`modify_supply_points`). Globalny limit to 2000 PZ. Aktualnie nie ma implementacji automatycznego zuÅ¼ycia PZ na utrzymanie w przebiegu tury (poza testowÄ… metodÄ… `pay_unit_maintenance`). 
- **Konwersja PE â†’ PZ:** Istnieje metoda `produce_supply(nation, cost, amount)` pozwalajÄ…ca wydatkowaÄ‡ punkty ekonomiczne w zamian za okreÅ›lonÄ… liczbÄ™ punktÃ³w zaopatrzenia. PrzykÅ‚adowo, w testach wywoÅ‚anie `produce_supply("Polska", 300, 150)` zmniejsza PE o 300 i zwiÄ™ksza PZ o 150. Oznacza to bieÅ¼Ä…cy **kurs wymiany 2:1** (2 PE za 1 PZ). Obecnie brak interfejsu do rÄ™cznego skorzystania z tej konwersji podczas rozgrywki â€“ jest to tylko funkcja wewnÄ™trzna.
- **Utrzymanie jednostek:** W `EconomySystem` jest metoda `pay_unit_maintenance(nation, cost_per_unit, unit_count)`, ktÃ³ra odejmuje z puli PZ koszt utrzymania pewnej liczby jednostek. Na ten moment nie jest ona automatycznie wywoÅ‚ywana co turÄ™ (metoda `process_turn` wywoÅ‚uje jÄ…, ale `process_turn` nie jest jeszcze podpiÄ™ty do mechaniki tur w `main.py`). Dodatkowo istnieje rozbudowana metoda `calculate_maintenance` prÃ³bujÄ…ca symulowaÄ‡ pobÃ³r zaopatrzenia przez kaÅ¼dÄ… jednostkÄ™ z najbliÅ¼szej bazy â€“ jednak w aktualnej fazie projektu jednostki nie sÄ… powiÄ…zane z bazami, wiÄ™c ta funkcjonalnoÅ›Ä‡ nie jest wykorzystywana.

PodsumowujÄ…c, system ekonomiczny jest zarysowany â€“ gromadzi punkty i ma operacje konwersji oraz utrzymania â€“ lecz **nie zostaÅ‚ w peÅ‚ni zintegrowany z przebiegiem gry**. Brakuje wywoÅ‚aÅ„ tych mechanizmÃ³w podczas zmiany tury i interfejsu dla gracza.

### Bazy zaopatrzeniowe
Koncept baz zaopatrzeniowych jest obecny szczÄ…tkowo. W `EconomySystem` istnieje lista `bases` dla kaÅ¼dej nacji oraz metoda `add_base(nation, x, y, supply_limit)` do dodania bazy z limitem zaopatrzenia. Dodane bazy sÄ… przechowywane jako sÅ‚owniki z polami `coords` (wspÃ³Å‚rzÄ™dne heksu) i `supply_limit` (maksymalna iloÅ›Ä‡ zaopatrzenia dostÄ™pna) wewnÄ…trz listy `bases` danej nacji. Obecnie domyÅ›lnie Å¼adnych baz nie dodano (listy startujÄ… puste). 

Kod posiada teÅ¼ funkcjÄ™ `find_nearest_base` do wyszukania najbliÅ¼szej bazy wzglÄ™dem jednostki, a `calculate_maintenance` wykorzystuje jÄ… by okreÅ›liÄ‡ dystans i potencjalnie zmniejszyÄ‡ limit zaopatrzenia bazy przy zaopatrywaniu jednostek. JednakÅ¼e, **brak jest integracji baz z edytorem mapy lub z rozgrywkÄ…** â€“ nie ma sposobu, aby zdefiniowaÄ‡ bazy w scenariuszu, ani by gracz mÃ³gÅ‚ je tworzyÄ‡ podczas gry. W efekcie funkcjonalnoÅ›ci baz (limit lokalnego zaopatrzenia, zaopatrywanie wedÅ‚ug odlegÅ‚oÅ›ci) pozostajÄ… nieaktywne.

### Wsparcie sojusznikÃ³w
Wsparcie od sojusznikÃ³w zostaÅ‚o czÄ™Å›ciowo zaimplementowane wewnÄ…trz systemu ekonomii jako metoda `calculate_support_from_allies(nation, allies)`. Jej dziaÅ‚anie polega na iteracji po przekazanym sÅ‚owniku sojusznikÃ³w z deklarowanym maksymalnym wsparciem i losowym przydziale czÄ™Å›ci tego wsparcia (losowany procent od 1 do 100). Wynik jest sumowany i dodawany jako dodatkowy przychÃ³d ekonomiczny danej nacji (`add_income`). PrzykÅ‚adowo, dla sojusznika z maksymalnie 100 PE wsparcia, losowy rzut moÅ¼e dodaÄ‡ proporcjonalnie np. 60 PE, co jest raportowane w konsoli komunikatem: *â€Sojusznik X przyznaÅ‚ 60 punktÃ³w ekonomicznych dla Polski (rzut: 60)â€*.

Ten mechanizm nie jest aktualnie wywoÅ‚ywany w trakcie gry â€“ brak systemu sojuszy przekazujÄ…cego realne dane do `calculate_support_from_allies`. RÃ³wnieÅ¼ nie ma GUI pozwalajÄ…cego np. poprosiÄ‡ o wsparcie. Funkcja stanowi **przygotowany szkielet** pod ewentualne przyszÅ‚e wydarzenia sojusznicze lub mechanikÄ™ dyplomacji, ale **nie wpÅ‚ywa** jeszcze na rozgrywkÄ™.

### Zdarzenia losowe
System ekonomii zawiera takÅ¼e metodÄ™ `random_event(nation)`, ktÃ³ra definiuje pulÄ™ czterech przykÅ‚adowych zdarzeÅ„ ekonomicznych:
- *Kryzys gospodarczy* (â€“500 PE),
- *Boom gospodarczy* (+500 PE),
- *NiedobÃ³r zaopatrzenia* (â€“200 PZ),
- *Dostawa zaopatrzenia* (+200 PZ).

Przy wywoÅ‚aniu wybierane jest losowo jedno z tych zdarzeÅ„ i jego efekty sÄ… przykÅ‚adane do wskazanej nacji (modyfikacja punktÃ³w). Informacja jest logowana w historii zdarzeÅ„ (`history`) danej nacji oraz wypisana w konsoli. Podobnie jak powyÅ¼ej, **nie podÅ‚Ä…czono tego mechanizmu do przebiegu tur** â€“ jedynie metoda `process_turn` w `EconomySystem` wywoÅ‚uje `random_event` na koniec przetwarzania tury, lecz `process_turn` nie jest jeszcze nigdzie wywoÅ‚ywana w gÅ‚Ã³wnym kodzie gry. W rezultacie **zdarzenia losowe nie pojawiajÄ… siÄ™ w normalnej rozgrywce**. StanowiÄ… one zalÄ…Å¼ek systemu losowoÅ›ci (np. zdarzeÅ„ ekonomicznych), ktÃ³ry wymaga wÅ‚Ä…czenia w cykl tury.

### Punkty kluczowe
**Punkty kluczowe** (strategiczne) zostaÅ‚y czÄ™Å›ciowo zaimplementowane. Edytor mapy pozwala oznaczaÄ‡ wybrane heksy jako punkty kluczowe o okreÅ›lonym typie i wartoÅ›ci. Struktura danych w pliku mapy (`mapa_dane.json` oraz roboczym `dane_terenow_hexow_working.json`) zawiera pole `"key_points"` ze sÅ‚ownikiem punktÃ³w kluczowych. KaÅ¼dy wpis ma klucz w formacie `"kolumna_wiersz"` i wartoÅ›Ä‡ zawierajÄ…cÄ… typ punktu oraz jego wartoÅ›Ä‡ (punktacjÄ™). PrzykÅ‚adowo, punkt typu *"miasto"* moÅ¼e mieÄ‡ wartoÅ›Ä‡ 100 (jak w dostarczonym JSON trzy miasta o wartoÅ›ci 100). W edytorze moÅ¼na dodaÄ‡ punkt kluczowy wybierajÄ…c typ z listy (â€mostâ€, â€miastoâ€, â€wÄ™zeÅ‚ komunikacyjnyâ€, â€fortyfikacjaâ€) â€“ odpowiadajÄ… im domyÅ›lne wartoÅ›ci 50, 100, 75, 150 â€“ oraz przypisaÄ‡ go do wybranego heksa. Mechanizm edytora zapisuje te dane do pliku mapy.

W trakcie gry punkty kluczowe mogÄ… zostaÄ‡ **zdobyte** przez gracza. W `EconomySystem` zdefiniowano metodÄ™ `capture_key_point(nation, hex_id)`, ktÃ³ra sprawdza czy dany heks jest kluczowy i jeÅ›li tak:
- dodaje odpowiedniÄ… wartoÅ›Ä‡ punktÃ³w ekonomicznych dla danej nacji (`add_income` o wartoÅ›Ä‡ punktu),
- wypisuje informacjÄ™ o zdobyciu (*â€Nacja X zdobyÅ‚a kluczowy punkt 'typ' ... i otrzymaÅ‚a Y punktÃ³w ekonomicznych.â€*),
- usuwa ten punkt z listy dostÄ™pnych (aby nie moÅ¼na byÅ‚o zdobyÄ‡ ponownie).

Aby ta mechanika zadziaÅ‚aÅ‚a, punkty kluczowe muszÄ… zostaÄ‡ wczytane. SÅ‚uÅ¼y do tego metoda `load_key_points(file_path)`, ktÃ³ra Å‚aduje plik JSON i zapisuje punkty do atrybutu `self.key_points`. W kodzie testowym jest wywoÅ‚ywana dla pliku roboczego mapy, natomiast w grze gÅ‚Ã³wnej *prawdopodobnie brakuje automatycznego wczytania* (nie widaÄ‡ wywoÅ‚ania `load_key_points` w `main.py`). MoÅ¼liwe, Å¼e zostaÅ‚o to przeoczone lub planowane do dodania. W efekcie **zdobywanie punktÃ³w kluczowych moÅ¼e nie dziaÅ‚aÄ‡** bez rÄ™cznego wczytania ich danych. Sama funkcjonalnoÅ›Ä‡ jednak jest gotowa po stronie logiki â€“ **zdobycie dodaje PE** zgodnie z wartoÅ›ciÄ… punktu.

### Generowanie i rozmieszczanie jednostek
Obecny prototyp nie posiada peÅ‚nego systemu **produkcji jednostek za punkty**. DostÄ™pne jednostki sÄ… wczytywane z folderÃ³w `tokeny/` i od razu dodawane do paneli nacji, skÄ…d gracz moÅ¼e je przeciÄ…gaÄ‡ na mapÄ™. W kodzie `main.py` podczas inicjalizacji nowej gry skanowane sÄ… wszystkie katalogi z Å¼etonami i kaÅ¼da znaleziona jednostka jest dodawana do odpowiedniego panelu bez Å¼adnego kosztu. Oznacza to, Å¼e **gracz ma natychmiastowy dostÄ™p do wszystkich zdefiniowanych Å¼etonÃ³w**. Nie ma ograniczeÅ„ liczebnych poza tym, Å¼e w obecnej implementacji kaÅ¼da jednostka wystÄ™puje tylko raz â€“ po przeciÄ…gniÄ™ciu jej na mapÄ™, zostaje usuniÄ™ta z panelu. JeÅ›li zostanie usuniÄ™ta z mapy (przeciÄ…gniÄ™ta z powrotem), wraca do panelu. Ta logika wskazuje na brak moÅ¼liwoÅ›ci posiadania duplikatÃ³w tego samego typu jednoczeÅ›nie. Dodatkowo, **rozmieszczenie nie wpÅ‚ywa na ekonomiÄ™** â€“ nie ubywajÄ… PE ani PZ przy stawianiu jednostki.

PodsumowujÄ…c, **generowanie jednostek nie jest powiÄ…zane z systemem ekonomii**. Brakuje mechanizmu kupowania nowych jednostek za punkty oraz mechanizmu ograniczania ich liczby przez zasoby. Obecnie funkcjonuje to jak nieograniczony â€magazynâ€ dostÄ™pnych jednostek, co z punktu widzenia docelowej gry strategicznej wymaga rozbudowy.

## Proponowane rozwiÄ…zania i usprawnienia

PoniÅ¼ej przedstawiono plan usprawnienia poszczegÃ³lnych systemÃ³w, tak aby dziaÅ‚aÅ‚y spÃ³jnie i byÅ‚y zrÃ³wnowaÅ¼one w przyszÅ‚ej rozgrywce.

### DomyÅ›lne koszty i utrzymanie jednostek
Aby zbalansowaÄ‡ ekonomiÄ™, naleÅ¼y ustaliÄ‡ **domyÅ›lne wartoÅ›ci kosztu zakupu (PE)** oraz **kosztu utrzymania (PZ)** dla kaÅ¼dego typu jednostki. W projekcie zdefiniowano juÅ¼ takie wartoÅ›ci dla rÃ³Å¼nych kategorii w edytorze Å¼etonÃ³w â€“ poniÅ¼sza tabela podsumowuje je dla jednostek szczebla *pluton* (najmniejsza jednostka):

| Typ jednostki  | Koszt zakupu (PE) | Koszt utrzymania (PZ/turowo) |
|--------------- |------------------:|-----------------------------:|
| **P** (Piechota)         | 18   | 2   |
| **K** (Kawaleria)        | 20   | 3   |
| **TC** (CzoÅ‚gi ciÄ™Å¼kie)  | 24   | 5   |
| **TÅš** (CzoÅ‚gi Å›rednie)  | 22   | 4   |
| **TL** (CzoÅ‚gi lekkie)   | 20   | 3   |
| **TS** (CzoÅ‚gi szybkie/rozpoznawcze) | 18   | 2   |
| **AC** (Artyleria ciÄ™Å¼ka)| 22   | 3   |
| **AL** (Artyleria lekka) | 20   | 3   |
| **AP** (Artyleria ppanc.)| 18   | 3   |
| **Z** (Zaopatrzenie)**â€ **      | 16   | 2   |
| **D** (DowÃ³dztwo)**â€¡**         | 60   | 0   |
| **G** (Specjalna/**G**)**â€¡**   | 60   | 0   |

<small>**Å¹rÃ³dÅ‚o:** wartoÅ›ci na podstawie domyÅ›lnych danych w `token_editor.py`.</small>  
<small>**â€ ** Jednostka zaopatrzeniowa (np. ciÄ™Å¼arÃ³wka zaopatrzenia) â€“ relatywnie tania, umiarkowane utrzymanie.</small>  
<small>**â€¡** Specjalne jednostki (np. dowÃ³dztwo, sztab) â€“ wysoki jednorazowy koszt, brak kosztÃ³w utrzymania.</small>

WartoÅ›ci te wydajÄ… siÄ™ rozsÄ…dne jako punkt wyjÅ›cia do balansu. MoÅ¼na zauwaÅ¼yÄ‡, Å¼e wiÄ™ksze jednostki majÄ… koszty wielokrotnoÅ›ci tych z plutonu (mniej wiÄ™cej *Kompania* = 2Ã— pluton, *Batalion* = 3Ã— pluton dla wielu typÃ³w). NaleÅ¼y zachowaÄ‡ te proporcje, tak aby gracze mieli wybÃ³r miÄ™dzy wiÄ™kszymi formacjami a wiÄ™kszÄ… liczbÄ… mniejszych jednostek:
- **Infantry (Piechota P):** najtaÅ„sza podstawowa jednostka, koszt roÅ›nie liniowo (np. kompania ~36 PE, batalion ~54 PE) a utrzymanie ~2/4/8 PZ.
- **Cavalry (K):** nieco droÅ¼sza od piechoty ze wzglÄ™du na mobilnoÅ›Ä‡ (pluton 20 PE, batalion ~60 PE) i wyÅ¼sze utrzymanie.
- **Tanks:** zrÃ³Å¼nicowane â€“ lekkie i szybkie (TL, TS) sÄ… taÅ„sze (18â€“20 PE pluton) niÅ¼ Å›rednie (TÅš 22) i ciÄ™Å¼kie (TC 24). Utrzymanie czoÅ‚gÃ³w jest znaczÄ…co wyÅ¼sze (do 5 PZ/pluton ciÄ™Å¼kich). To oddaje wiÄ™ksze zapotrzebowanie na zaopatrzenie paliwa i czÄ™Å›ci.
- **Artillery:** koszt podobny do czoÅ‚gÃ³w lekkich/Å›rednich, utrzymanie umiarkowane (np. 3 PZ/pluton). CiÄ™Å¼sza artyleria (AC) ma wiÄ™kszy koszt zakupu niÅ¼ lekka (AL, AP).
- **Supply (Z):** bardzo niskie koszty zakupu (16) i utrzymania (2) â€“ sugeruje siÄ™, Å¼e sÄ… to np. ciÄ™Å¼arÃ³wki zaopatrzeniowe konieczne do logistyki. 
- **DowÃ³dztwo/HQ (D, G):** traktowane jako specjalne â€“ koszt 60, brak utrzymania. MoÅ¼liwe, Å¼e reprezentujÄ… sztaby lub grupy operacyjne; ich brak kosztu utrzymania oznacza, Å¼e nie obciÄ…Å¼ajÄ… logistyki po rozmieszczeniu.

**Zalecenie:** UtrzymaÄ‡ powyÅ¼sze wartoÅ›ci jako domyÅ›lne. W razie potrzeby doprecyzowaÄ‡ typy `D` i `G` (np. czy `G` to sztab generalny, lotnictwo czy inny element) i ewentualnie rozszerzyÄ‡ listÄ™ typÃ³w. DomyÅ›lne wartoÅ›ci powinny byÄ‡ przechowywane w jednym miejscu (np. w pliku konfiguracyjnym JSON lub centralnej strukturze) â€“ obecnie sÄ… zaszyte w kodzie edytora Å¼etonÃ³w. **Lepiej przenieÅ›Ä‡ je do pliku** (np. `data/default_unit_stats.json`), z ktÃ³rego edytor i gra mogÅ‚yby je odczytywaÄ‡, uÅ‚atwiajÄ…c balansowanie bez zmian kodu.

### Konwersja punktÃ³w ekonomicznych na zaopatrzenie (PE â†’ PZ)
Aby powiÄ…zaÄ‡ ze sobÄ… system ekonomii i logistyki, naleÅ¼y umoÅ¼liwiÄ‡ **rÄ™czne konwertowanie** punktÃ³w ekonomicznych na punkty zaopatrzenia przez gracza podczas rozgrywki. Obecnie mechanika ta jest zaszyta w funkcji `produce_supply`, ale brak interfejsu â€“ planowane usprawnienia:
- **StaÅ‚y kurs wymiany:** UtrzymaÄ‡ domyÅ›lny kurs 2 PE = 1 PZ (zgodnie z testowym wykorzystaniem 300â†’150). Kurs ten moÅ¼na ewentualnie zbalansowaÄ‡ w przyszÅ‚oÅ›ci, ale na start jest intuicyjny (wydajnoÅ›Ä‡ gospodarczÄ… przelicza siÄ™ na poÅ‚owÄ™ efektywnoÅ›ci logistycznej).
- **Interfejs GUI konwersji:** W panelu informacji ekonomicznych lub w menu akcji nacji dodaÄ‡ przycisk **â€Konwertuj zasobyâ€**. Po klikniÄ™ciu pojawia siÄ™ okno dialogowe pozwalajÄ…ce graczowi wprowadziÄ‡, ile punktÃ³w ekonomicznych chce zamieniÄ‡ na zaopatrzenie. MoÅ¼na teÅ¼ dodaÄ‡ szybkie opcje (np. +50 PZ za 100 PE, +100 PZ za 200 PE).
- **Weryfikacja i wykonanie:** Po zatwierdzeniu naleÅ¼y wywoÅ‚aÄ‡ `economy_system.produce_supply(nation, cost, supply_amount)`. NaleÅ¼y upewniÄ‡ siÄ™, Å¼e gracz ma wystarczajÄ…cÄ… liczbÄ™ PE â€“ jeÅ›li nie, interfejs powinien zablokowaÄ‡ takÄ… transakcjÄ™ lub wyÅ›wietliÄ‡ komunikat (metoda juÅ¼ to sprawdza i drukuje ostrzeÅ¼enie w konsoli, ale powinno to byÄ‡ przeniesione do komunikatu GUI).
- **Ograniczenia i cooldown:** Dla balansu moÅ¼na rozwaÅ¼yÄ‡ ograniczenie czÄ™stotliwoÅ›ci lub maksymalnego jednorazowego transferu (np. nie wiÄ™cej niÅ¼ 50% aktualnych PE na turÄ™), aby gracz nie mÃ³gÅ‚ w jednej chwili przepaliÄ‡ caÅ‚ej gospodarki na zaopatrzenie. Na poczÄ…tek jednak moÅ¼na nie wprowadzaÄ‡ sztucznych limitÃ³w â€“ sam fakt, Å¼e zasoby sÄ… ograniczone kwotÄ… PE, jest limitem.

IntegrujÄ…c konwersjÄ™, stworzymy **pomost miÄ™dzy ekonomiÄ… a zaopatrzeniem**: nadwyÅ¼ki finansowe gracz moÅ¼e przeznaczyÄ‡ na podtrzymanie armii. To waÅ¼ne, szczegÃ³lnie gdy koszty utrzymania rosnÄ… wraz z liczbÄ… jednostek.

Dodatkowo warto rozwaÅ¼yÄ‡ **automatycznÄ… konwersjÄ™ na koniec tury**: np. okreÅ›lony uÅ‚amek niewykorzystanych PE mÃ³gÅ‚by przechodziÄ‡ na PZ (symulacja inwestowania w zapasy). Jednak takie reguÅ‚y powinny byÄ‡ czytelne dla gracza â€“ na razie lepiej trzymaÄ‡ siÄ™ podejÅ›cia manualnego, by daÄ‡ graczowi peÅ‚nÄ… kontrolÄ™.

### Struktura danych baz zaopatrzenia i punktÃ³w kluczowych (JSON)
Obecna struktura pliku mapy przechowuje jedynie teren i punkty kluczowe. Proponuje siÄ™ ujednolicenie i rozszerzenie formatu JSON o informacjÄ™ o **bazach zaopatrzeniowych** oraz ewentualnie przypisanie punktÃ³w kluczowych do nacji (jeÅ›li startowo jakieÅ› punkty sÄ… juÅ¼ w posiadaniu stron).

**Propozycja 1:** Rozszerzenie pliku mapy (np. `mapa_dane.json`) o sekcje dla baz. MoÅ¼na dodaÄ‡ nowy klucz top-level, np. `"bases"`, ktÃ³rego wartoÅ›Ä‡ bÄ™dzie sÅ‚ownikiem zawierajÄ…cym listy baz dla poszczegÃ³lnych nacji:
```json
{
  "terrain": { ... },
  "key_points": {
    "4_3": { "type": "miasto", "value": 100 },
    "...": { ... }
  },
  "bases": {
    "Polska": [
      { "coords": [x, y], "supply_limit": 500 },
      { "coords": [x2, y2], "supply_limit": 300 }
    ],
    "Niemcy": [
      { "coords": [u, v], "supply_limit": 400 }
    ]
  }
}
```
Taka struktura pozwala zdefiniowaÄ‡ dowolnÄ… liczbÄ™ baz dla kaÅ¼dej strony wraz z ich poÅ‚oÅ¼eniem i poczÄ…tkowym limitem zaopatrzenia (maksymalnym zapasem/zdolnoÅ›ciÄ… zaopatrywania). Wczytanie tych danych zapewni metoda np. `load_bases(file_path)` w `EconomySystem`, analogiczna do `load_key_points`. Przy starcie scenariusza gra wywoÅ‚a `economy_system.load_key_points(...)` oraz `economy_system.load_bases(...)` wskazujÄ…c plik mapy/scenariusza. 

**Propozycja 2:** Alternatywnie, jeÅ›li chcemy rozdzieliÄ‡ dane scenariusza od danych mapy, moÅ¼emy stworzyÄ‡ osobny plik **scenariusza** (np. `scenario_1939.json`) ktÃ³ry zawiera zarÃ³wno nazwÄ™ mapy jak i dodatkowe informacje:
```json
{
  "map": "mapa1",
  "start_resources": {
    "Polska": { "PE": 1000, "PZ": 500 },
    "Niemcy": { "PE": 2000, "PZ": 1000 }
  },
  "bases": { ... jak wyÅ¼ej ... },
  "key_points": { ... jak wyÅ¼ej ... },
  "initial_units": { ... jeÅ›li przewidujemy startowe jednostki rozstawione ... }
}
```
WÃ³wczas plik mapy pozostaÅ‚by czysto geograficzny (heksy i tereny), a plik scenariusza definiowaÅ‚by ekonomiÄ™ i rozmieszczenie. To bardziej kompleksowe podejÅ›cie, ktÃ³re uÅ‚atwi tworzenie rÃ³Å¼nych scenariuszy na tej samej mapie. Jednak implementacyjnie wymaga to obsÅ‚ugi dwÃ³ch plikÃ³w i jest nieco bardziej zÅ‚oÅ¼one.

Na potrzeby najbliÅ¼szego etapu moÅ¼na wdroÅ¼yÄ‡ pierwszÄ…, prostszÄ… propozycjÄ™ â€“ dodaÄ‡ bazy do pliku mapy. Punkty kluczowe juÅ¼ sÄ… tam zawarte jako `"key_points"`. Warto upewniÄ‡ siÄ™, Å¼e format zapisu punktÃ³w kluczowych nie wymaga przypisania do strony (na ogÃ³Å‚ punkty kluczowe sÄ… neutralne do momentu zajÄ™cia, co obecny format odzwierciedla brakiem informacji o wÅ‚aÅ›cicielu).

**Podsumowanie struktury:**
- **key_points:** sÅ‚ownik `hex_id -> {type, value}` (neutralne, wartoÅ›Ä‡ punktÃ³w dodawana zdobywcy).
- **bases:** sÅ‚ownik `nation -> [ {coords: [x,y], supply_limit: N}, ... ]` (pozycje baz danej nacji z ich pojemnoÅ›ciÄ… zaopatrzenia).

Przechowywanie tych informacji w JSON pozwoli edytorowi mapy i gÅ‚Ã³wnej grze korzystaÄ‡ ze spÃ³jnego ÅºrÃ³dÅ‚a danych. UÅ‚atwi to teÅ¼ modyfikacje scenariusza (np. dodanie nowej bazy â€“ wystarczy edycja pliku zamiast zmian w kodzie).

### Interfejs GUI â€“ konwersja zasobÃ³w i tworzenie baz
Aby mechanizmy konwersji zasobÃ³w i budowy baz byÅ‚y dostÄ™pne dla gracza, naleÅ¼y rozbudowaÄ‡ interfejs uÅ¼ytkownika o odpowiednie elementy sterujÄ…ce.

**1. Konwersja PE â†’ PZ:**  
Dodajmy przycisk w panelu ekonomii, np. **â€Konwertuj PE na PZâ€**. Po jego klikniÄ™ciu otworzy siÄ™ okno dialogowe (moÅ¼na wykorzystaÄ‡ `tkinter.simpledialog` lub wÅ‚asne okno) z pytaniem o liczbÄ™ punktÃ³w do konwersji. MoÅ¼liwe parametry:
- DomyÅ›lnie moÅ¼e byÄ‡ wpisana maksymalna moÅ¼liwa liczba (caÅ‚e dostÄ™pne PE) lub poÅ‚owa.
- Po zatwierdzeniu gra wywoÅ‚uje metodÄ™ `economy_system.produce_supply(current_nation, cost, converted_supply)`, gdzie `converted_supply` = `cost/2` przy zaÅ‚oÅ¼eniu kursu 2:1. MoÅ¼na teÅ¼ pozwoliÄ‡ graczowi wpisaÄ‡ bezpoÅ›rednio ile PZ chce uzyskaÄ‡, a koszt obliczaÄ‡ automatycznie.
- Wynik powinien zaktualizowaÄ‡ natychmiast **panel informacji ekonomicznych**. NaleÅ¼y wiÄ™c wywoÅ‚aÄ‡ `update_economic_info()` po dokonaniu konwersji, aby odÅ›wieÅ¼yÄ‡ wyÅ›wietlane wartoÅ›ci.

Od strony kodu, implementacja moÅ¼e byÄ‡ wykonana w klasie `GameInterface` (w `main.py`). MoÅ¼na dodaÄ‡ metodÄ™ `open_convert_dialog()` obsÅ‚ugujÄ…cÄ… ten dialog, a przycisk stworzyÄ‡ podczas inicjalizacji panelu ekonomii (np. poniÅ¼ej tekstowego pola informacji). Stylowo, przycisk moÅ¼e byÄ‡ maÅ‚y i opisany np. "Konwertuj..." z ikonÄ… zasobÃ³w dla czytelnoÅ›ci.

**2. Tworzenie nowych baz zaopatrzenia:**  
Budowa bazy przez gracza to istotny element strategii (np. gracz wycofuje siÄ™ i tworzy liniÄ™ zaopatrzenia z tyÅ‚u). Proponowane rozwiÄ…zanie:
- Dodaj przycisk **â€Zbuduj bazÄ™ zaopatrzeniaâ€** dostÄ™pny dla gracza (np. w menu akcji tury albo w panelu nacji). MoÅ¼na go umieÅ›ciÄ‡ obok przycisku â€ZakoÅ„cz turÄ™â€ lub w innym dobrze widocznym miejscu.
- Po klikniÄ™ciu, gracz powinien wybraÄ‡ heks na mapie, gdzie baza zostanie utworzona. Technicznie: po wciÅ›niÄ™ciu przycisku interfejs moÅ¼e przejÅ›Ä‡ w tryb wyczekiwania na wskazanie heksu (np. zmienna w `GameInterface` `placing_base_mode = True`). MoÅ¼na teÅ¼ otworzyÄ‡ okno dialogowe z proÅ›bÄ… â€Kliknij na mapie, gdzie utworzyÄ‡ bazÄ™â€ â€“ i nastÄ™pne klikniÄ™cie na mapie, obsÅ‚ugiwane w metodzie `on_hex_press` lub podobnej, sprawdzi ten tryb i wykona akcjÄ™ bazy zamiast normalnego dziaÅ‚ania.
- **Koszt utworzenia bazy:** NaleÅ¼y zdefiniowaÄ‡, ile kosztuje postawienie nowej bazy. Racjonalnie mogÅ‚oby to byÄ‡ znaczÄ…ce obciÄ…Å¼enie **punktÃ³w ekonomicznych** â€“ np. 200 czy 300 PE â€“ by baza nie byÅ‚a stawiana zbyt czÄ™sto. Alternatywnie lub dodatkowo, moÅ¼na wymagaÄ‡ zuÅ¼ycia pewnej puli **punktÃ³w zaopatrzenia** na zapeÅ‚nienie nowej bazy (co symulowaÅ‚oby koniecznoÅ›Ä‡ dostarczenia tam zapasÃ³w). Na poczÄ…tek proponujemy prosty koszt w PE, np. *200 PE za bazÄ™*.
- **Wykonanie budowy:** Gdy gracz wybierze heks, gra:
  - Sprawdza warunki: gracz musi mieÄ‡ >= koszt PE, wybrany heks musi byÄ‡ przyjazny (np. znajdujÄ…cy siÄ™ pod kontrolÄ… gracza lub na jego terytorium â€“ jeÅ›li wprowadzimy strefy kontroli, ale to przyszÅ‚oÅ›Ä‡; na razie moÅ¼na tylko sprawdziÄ‡, czy nie ma juÅ¼ tam bazy).
  - Odejmuje koszt z punktÃ³w ekonomicznych (`economy_system.spend_economic_points(nation, cost, "Budowa bazy")` â€“ logika juÅ¼ istnieje).
  - Dodaje bazÄ™: wywoÅ‚uje `economy_system.add_base(nation, x, y, supply_limit)`. `supply_limit` nowej bazy moÅ¼e byÄ‡ domyÅ›lny (np. 100) lub zaleÅ¼ny od zainwestowanych Å›rodkÃ³w (np. 200 PE daje bazÄ™ o limit 100; ewentualnie wiÄ™kszy koszt mÃ³gÅ‚by daÄ‡ bazÄ™ o wiÄ™kszym limicie, ale trzymajmy siÄ™ prostego zaÅ‚oÅ¼enia staÅ‚ego limitu).
  - Aktualizuje dane mapy/gry: naleÅ¼y dodaÄ‡ wpis o bazie w wewnÄ™trznej strukturze (np. `placed_bases` lub w `hex_data` danego heksu). Warto rÃ³wnieÅ¼ wizualnie zaznaczyÄ‡ bazÄ™ na mapie â€“ np. na canvasie narysowaÄ‡ symbol (maÅ‚y kwadrat lub ikonÄ™ skrzyni). MoÅ¼na to zrobiÄ‡ podobnie jak rysowane sÄ… Å¼etony czy punkty kluczowe (np. funkcjÄ… `create_oval` lub wczytujÄ…c maÅ‚Ä… grafikÄ™ bazy).
  - Uaktualnia panel ekonomii: baza sama w sobie nie wpÅ‚ywa na PE/PZ, wiÄ™c wystarczy np. odÅ›wieÅ¼yÄ‡ wyÅ›wietlanÄ… listÄ™ baz w raporcie ekonomicznym. `generate_report` juÅ¼ wypisuje listÄ™ baz z ich limitami, wiÄ™c po dodaniu bazy warto wywoÅ‚aÄ‡ ponownie `update_economic_info()` aby gracz widziaÅ‚ nowÄ… bazÄ™ w raporcie.

**3. ZarzÄ…dzanie bazami:** (plan na przyszÅ‚oÅ›Ä‡) MoÅ¼na rozwaÅ¼yÄ‡ dodanie interfejsu do **ulepszania baz** (zwiÄ™kszania ich limitu zaopatrzenia kosztem PZ lub PE) oraz do przenoszenia/likwidowania baz. Na razie jednak podstawowe stawianie i wykorzystywanie baz jest priorytetem.

### System pogodowy (planowany)
Warunki pogodowe mogÄ… znaczÄ…co wpÅ‚ynÄ…Ä‡ na rozgrywkÄ™ (ruch, efektywnoÅ›Ä‡ bojowÄ…, zuÅ¼ycie zaopatrzenia). Na ten moment gra nie posiada moduÅ‚u pogodowego â€“ proponujemy zarysy takiego systemu z myÅ›lÄ… o przyszÅ‚ej implementacji:
- **Lokalizacja kodu:** Najlepiej umieÅ›ciÄ‡ nowy system w module `engine/weather.py` jako klasÄ™ `WeatherSystem`. BÄ™dzie on analogiczny do innych systemÃ³w w katalogu `engine` (tak jak `VisibilitySystem` czy planowany `TurnManager`). DziÄ™ki temu logika pogody bÄ™dzie odseparowana od GUI i innych elementÃ³w.
- **Reprezentacja pogody:** Klasa WeatherSystem moÅ¼e przechowywaÄ‡ aktualny stan pogody (np. `self.current_weather`) oraz mieÄ‡ metodÄ™ do zmiany na kolejnÄ… pogodÄ™ (np. `next_turn()` lub `randomize_weather()`). PogodÄ™ moÅ¼na okreÅ›laÄ‡ jako enum/napis, np. `"Pogodnie"`, `"Deszcz"`, `"Rasputica"`, `"Åšnieg"`, itp. wraz z parametrami wpÅ‚ywu.
- **WpÅ‚yw na grÄ™:** NaleÅ¼y zdefiniowaÄ‡, jakie efekty niesie kaÅ¼da pogoda. PrzykÅ‚adowo:
  - Deszcz: zmniejszenie punktÃ³w ruchu jednostek o 1, obniÅ¼enie skutecznoÅ›ci lotnictwa (jeÅ›li jest) i zwiÄ™kszenie kosztu utrzymania (wiÄ™cej paliwa na pokonywanie bÅ‚ota).
  - BÅ‚oto (rasputica): drastyczne zmniejszenie ruchu pojazdÃ³w gÄ…sienicowych i koÅ‚owych, piechota mniej dotkniÄ™ta.
  - Åšnieg/MrÃ³z: zmniejszenie skutecznoÅ›ci bojowej nieprzygotowanych jednostek, wiÄ™ksze zapotrzebowanie na zaopatrzenie (paliwo do ogrzewania, wyÅ¼sze zuÅ¼ycie).
  - Pogoda dobra: brak modyfikatorÃ³w.
- **Integracja z turami:** WeatherSystem powinien byÄ‡ wywoÅ‚ywany na poczÄ…tku kaÅ¼dej tury (lub co kilka tur, zaleÅ¼nie od scenariusza). JeÅ›li powstanie klasa `TurnManager` obsÅ‚ugujÄ…ca fazy, to po zwiÄ™kszeniu licznika tur moÅ¼na wywoÅ‚aÄ‡ np. `weather_system.new_turn(turn_number)` by potencjalnie zmieniÄ‡ warunki (np. co turÄ™ losowaÄ‡ pogodÄ™ z pewnym prawdopodobieÅ„stwem zmiany). MoÅ¼na teÅ¼ skryptowaÄ‡ pogodÄ™ w scenariuszu â€“ np. 1 wrzeÅ›nia pogodnie, od 3 wrzeÅ›nia deszcze, itp., poprzez zdefiniowanie listy warunkÃ³w per tura.
- **WpÅ‚yw na inne systemy:** Np. w `calculate_movement` jednostki moÅ¼na uwzglÄ™dniaÄ‡ modyfikator ruchu zaleÅ¼nie od `WeatherSystem.current_weather`. Podobnie w systemie zaopatrzenia â€“ w trudnej pogodzie koszt zaopatrzenia per dystans moÅ¼e wzrosnÄ…Ä‡ (np. baza zaopatrujÄ…ca oddziaÅ‚ daleko zuÅ¼yje wiÄ™cej PZ w bÅ‚ocie). Te modyfikacje mogÅ‚yby byÄ‡ zaimplementowane w istniejÄ…cych metodach: np. `calculate_distance`/`find_nearest_base` moÅ¼e dodatkowo mnoÅ¼yÄ‡ dystans przez czynnik pogodowy, albo `pay_unit_maintenance` mnoÅ¼yÄ‡ koszt.
- **GUI pogody:** W interfejsie warto wyÅ›wietlaÄ‡ aktualnÄ… pogodÄ™ â€“ np. jako ikonkÄ™ i opis przy etykiecie tury (np. â€Tura 5 â€“ Deszczâ€). 

Implementacja systemu pogodowego bÄ™dzie nieco izolowana od reszty, wiÄ™c moÅ¼na jÄ… wprowadziÄ‡ w dowolnym momencie. W pierwszej iteracji moÅ¼e po prostu losowo zmieniaÄ‡ warunki co kilka tur i wypisywaÄ‡ komunikat (to bÄ™dzie spÃ³jne z zasadÄ…, Å¼e nawet niezaimplementowane elementy powinny dawaÄ‡ jakiÅ› komunikat â€“ zgodnie z podejÅ›ciem skeletonÃ³w). Kod najlepiej umieÅ›ciÄ‡ w module `engine/weather.py` i importowaÄ‡ go w `main.py` oraz/lub `turns.py`. JeÅ›li nie ma jeszcze zaimplementowanego `TurnManager`, tymczasowo wywoÅ‚ania pogodowe moÅ¼na umieÅ›ciÄ‡ w `end_turn()` w `GameInterface` â€“ np. po przeÅ‚Ä…czeniu gracza i zanim nastÄ…pi kolejna tura, zmieniÄ‡ pogodÄ™.

### Usprawnienia edytora mapy (bazy zaop. i punkty kluczowe)
Edytor mapy (`gui/map_editor.py`) powinien zostaÄ‡ rozbudowany, by obsÅ‚ugiwaÅ‚ rÃ³wnieÅ¼ nowe elementy:
- **Dodawanie baz zaopatrzenia:** Analogicznie do istniejÄ…cego mechanizmu punktÃ³w kluczowych, dodaj przycisk **â€Dodaj bazÄ™ zaopatrzeniaâ€**. Po jego klikniÄ™ciu uÅ¼ytkownik wybiera heks na mapie, a nastÄ™pnie pojawia siÄ™ dialog z wyborem nacji (Polska/Niemcy) oraz wpisaniem limitu zaopatrzenia (domyÅ›lnie np. 100). Po zatwierdzeniu edytor:
  - Zapisuje w strukturze `self.bases` nowy wpis. Struktura moÅ¼e byÄ‡ podobna jak proponowany JSON: np. `self.bases = {"Polska": {}, "Niemcy": {}}` i wpis `self.bases["Polska"][hex_id] = {"supply_limit": 100}`.
  - Rysuje na mapie symbol bazy na wybranym polu (np. niebieski kwadrat dla polskiej, czarny dla niemieckiej bazy, lub litery P/N).
  - Aktualizuje licznik/label informacyjny (podobnie jak jest `key_point_info_label` dla punktÃ³w kluczowych, moÅ¼na mieÄ‡ `base_info_label` pokazujÄ…cy szczegÃ³Å‚y bazy pod kursorem).
  - Przy zapisie mapy do pliku doÅ‚Ä…cza strukturÄ™ baz. JeÅ›li przyjmiemy strukturÄ™ per nacja, JSON mÃ³gÅ‚by byÄ‡ zorganizowany jak wyÅ¼ej (osobna sekcja). Edytor powinien wiÄ™c serializowaÄ‡ `self.bases` do formatu zgodnego z ustalonym â€“ np. zamieniÄ‡ wewnÄ™trznÄ… reprezentacjÄ™ na sÅ‚ownik z listami baz.
- **Edycja/usuwanie baz:** Dobrze dodaÄ‡ moÅ¼liwoÅ›Ä‡ usuniÄ™cia bazy (np. PPM na bazie lub specjalny przycisk "UsuÅ„ bazÄ™" dziaÅ‚ajÄ…cy podobnie jak usuwanie punktÃ³w kluczowych, ktÃ³re w edytorze jest realizowane poprzez czyszczenie caÅ‚ej listy â€“ tu lepiej pojedynczo). MoÅ¼na np. w dialogu dodawania umoÅ¼liwiÄ‡ teÅ¼ tryb usuwania: klikniÄ™cie bazy gdy aktywny jest przycisk "Dodaj bazÄ™" mogÅ‚oby usuwaÄ‡ istniejÄ…cÄ….
- **Synchronizacja z plikiem:** Edytor podczas wczytywania pliku mapy musi odczytaÄ‡ rÃ³wnieÅ¼ bazÄ™ (sekcjÄ™ bases). Np. `loaded_data.get("bases", {})` i odpowiednio zapeÅ‚niÄ‡ `self.bases` oraz narysowaÄ‡ te bazy na mapie. Podczas zapisu â€“ dopisaÄ‡ do `map_data` klucz `"bases"` i zapisaÄ‡.

- **Punkty kluczowe â€“ drobne poprawki:** Skoro edytor juÅ¼ obsÅ‚uguje punkty kluczowe, warto upewniÄ‡ siÄ™, Å¼e:
  - Gdy uÅ¼ytkownik usunie punkt kluczowy (np. wyczyÅ›ci mapÄ™), zapis usunie go z pliku â€“ obecnie jest opcja usuniÄ™cia wszystkich naraz, co dziaÅ‚a, ale brak usuwania pojedynczego.
  - RozwaÅ¼yÄ‡ moÅ¼liwoÅ›Ä‡ przypisania punktu kluczowego do konkretnej nacji (chociaÅ¼ obecnie zakÅ‚adamy, Å¼e wszystkie sÄ… neutralne startowo). MoÅ¼na to pominÄ…Ä‡, bo gra i tak obsÅ‚uguje zdobywanie dynamicznie.

PodsumowujÄ…c, edytor mapy po zmianach pozwoli w peÅ‚ni przygotowaÄ‡ dane scenariusza: oznaczyÄ‡ waÅ¼ne miasta i mosty jako punkty kluczowe oraz okreÅ›liÄ‡, gdzie znajdujÄ… siÄ™ poczÄ…tkowe bazy zaopatrzenia obu stron. DziÄ™ki temu osoba tworzÄ…ca scenariusz bÄ™dzie miaÅ‚a narzÄ™dzie do konfiguracji logistyki.

### Generowanie jednostek z wykorzystaniem PE
NajwiÄ™ksza zmiana dla rozgrywki to wprowadzenie **systemu rekrutacji jednostek za punkty ekonomiczne**. Proponuje siÄ™ nastÄ™pujÄ…ce podejÅ›cie:
1. **Oddzielenie â€szablonÃ³wâ€ jednostek od instancji:** Aktualnie foldery w `tokeny/` peÅ‚niÄ… rolÄ™ jednoczeÅ›nie definicji jednostki i pojedynczego Å¼etonu. Aby mÃ³c kupowaÄ‡ wiele jednostek tego samego typu, warto traktowaÄ‡ te foldery jako *wzorce*. MoÅ¼na utrzymaÄ‡ obecnÄ… strukturÄ™ (kaÅ¼dy folder zawiera obrazek i dane typu jednostki). Natomiast panel Å¼etonÃ³w nie powinien od razu zawieraÄ‡ wszystkich tych jednostek jako gotowych do rozstawienia, tylko raczej listÄ™ dostÄ™pnych do zakupu.
2. **Interfejs zakupÃ³w:** W interfejsie gry, dla kaÅ¼dej nacji, dodaj zakÅ‚adkÄ™ lub panel **â€Rekrutacjaâ€**. MoÅ¼e to byÄ‡ czÄ™Å›Ä‡ istniejÄ…cego panelu Å¼etonÃ³w lub osobne okno wywoÅ‚ywane przyciskiem â€Kup jednostkiâ€. PrzykÅ‚adowa realizacja w GUI:
   - Obok nagÅ‚Ã³wka "Å»etony Polskie" dodaj przycisk "+" (lub â€Kupâ€). Po jego klikniÄ™ciu otwiera siÄ™ okno ze spisem dostÄ™pnych jednostek dla danej nacji.
   - Spis moÅ¼e byÄ‡ tabelkÄ…: nazwa jednostki, koszt (PE), ewentualnie ikona, przycisk Kup. Ewentualnie lista z opisem i przyciskiem.
   - Dane do wygenerowania tej listy bierzemy z katalogu `tokeny/nacja/` â€“ czyli np. odczytujemy `token_index.json` dla danej nacji, gdzie sÄ… wypisane typy jednostek. KaÅ¼dy typ ma przypisany `purchase_value` w swoim `token_data.json`. MoÅ¼na wiÄ™c zbudowaÄ‡ listÄ™ typu: *â€Pluton Piechoty â€“ koszt 18 PEâ€*, *â€Pluton CzoÅ‚gÃ³w Åšrednich â€“ 22 PEâ€* itd., uÅ¼ywajÄ…c tych wartoÅ›ci.
   - JeÅ›li dana jednostka nie powinna byÄ‡ dostÄ™pna (np. prototypy, limitowane), to `token_index.json` lub osobny mechanizm mÃ³gÅ‚by to oznaczaÄ‡. Na razie zakÅ‚adamy, Å¼e dostÄ™pne sÄ… wszystkie zdefiniowane.
3. **Logika zakupu:** Kiedy gracz wybierze jednostkÄ™ i potwierdzi zakup:
   - Sprawdzamy czy ma wystarczajÄ…co PE. JeÅ›li nie, blokujemy (przycisk nieaktywny) lub komunikat.
   - JeÅ›li tak, zmniejszamy **punkty ekonomiczne** nacji o koszt (`economy_system.spend_economic_points(nation, cost, "Zakup jednostki X")`). To automatycznie doda wpis do historii. 
   - Tworzymy nowy Å¼eton jednostki w panelu. Tu sÄ… dwa podejÅ›cia:
     a) **Kopiowanie plikÃ³w:** MoÅ¼emy fizycznie skopiowaÄ‡ folder wzorca jednostki na nowy unikatowy (np. dodajÄ…c sufiks liczbowy do nazwy). Np. kupno drugiej piechoty tworzy folder `Polska P Pluton (2)` z plikiem PNG i danymi skopiowanymi z oryginaÅ‚u. NastÄ™pnie wczytujemy go tak samo jak przy starcie gry (Image, dane) i dodajemy do `TokenPanel`. Zaleta: Å‚atwa integracja z obecnÄ… logikÄ… (foldery jako jednostki). Wady: zaÅ›miecanie struktury plikÃ³w oraz koniecznoÅ›Ä‡ czyszczenia ich (co czÄ™Å›ciowo juÅ¼ jest robione przy `lock_nation_tokens` â€“ usuwa foldery jednostek rozmieszczonych). Jednak poniewaÅ¼ gra dziaÅ‚a lokalnie, a scenariusz nie bÄ™dzie miaÅ‚ setek jednostek, to kopiowanie jest akceptowalne.
     b) **WewnÄ™trzna reprezentacja:** OdejÅ›Ä‡ od kopiowania i przechowywaÄ‡ wiele instancji w pamiÄ™ci, ale to wymagaÅ‚oby zmiany struktury `placed_token_images` i panelu tak, by nie bazowaÅ‚y na unikalnej nazwie=folderze. MoÅ¼na np. nadaÄ‡ unikalny identyfikator kaÅ¼dej kupionej jednostce (np. Piechota#1, Piechota#2) i przechowywaÄ‡ tylko referencjÄ™ do jednego obrazka. To jednak wymaga refaktoryzacji sposobu przechowywania Å¼etonÃ³w. W ramach obecnego projektu **prostsze bÄ™dzie podejÅ›cie z kopiowaniem** folderÃ³w przy zakupie â€“ pozwoli to skorzystaÄ‡ z istniejÄ…cego mechanizmu wczytywania i usuwania.
   - Dodajemy nowy Å¼eton do panelu danej nacji (`TokenPanel.add_token`). Panel juÅ¼ obsÅ‚uguje wyÅ›wietlanie i przeciÄ…ganie.
   - Aktualizujemy wyÅ›wietlane zasoby (PE ubyÅ‚o â€“ wiÄ™c `update_economic_info()` aby gracz widziaÅ‚ nowe wartoÅ›ci punktÃ³w).
4. **Ograniczenia i balans:** MoÅ¼emy wprowadziÄ‡ ograniczenie, Å¼e zakupu moÅ¼na dokonywaÄ‡ tylko na **poczÄ…tku tury** (np. gdy jednostki sÄ… odblokowane w panelu). Wtedy przycisk Kupno jest dostÄ™pny tylko jeÅ›li aktualnie jest faza planowania gracza, co moÅ¼na powiÄ…zaÄ‡ z flagÄ… `tokens_locked` (jeÅ›li Å¼etony nie sÄ… zablokowane, to znaczy moÅ¼na dokupywaÄ‡). W mechanice turowej typu IGOUGO, zwykle kupno/wystawienie posiÅ‚kÃ³w odbywa siÄ™ na poczÄ…tku swojej tury â€“ to dobre miejsce, aby nie pozwoliÄ‡ kupowaÄ‡ w dowolnym momencie (co mogÅ‚oby zaburzyÄ‡ pÅ‚ynnoÅ›Ä‡, np. reakcje na ruch przeciwnika).
   - MoÅ¼na teÅ¼ ograniczyÄ‡ miejsca, gdzie nowo kupione jednostki mogÄ… zostaÄ‡ postawione â€“ np. tylko w okreÅ›lonych strefach (przy krawÄ™dzi mapy, w pobliÅ¼u bazy zaopatrzenia lub miasta). To jednak wymaga mechanizmu kontroli terenu i wykracza poza obecny zakres (moÅ¼na pozostawiÄ‡ graczowi odpowiedzialnoÅ›Ä‡, by stawiaÅ‚ posiÅ‚ki sensownie).
   - Wsparcie sojusznikÃ³w i punkty kluczowe zasilajÄ… PE gracza, co umoÅ¼liwi finansowanie tych zakupÃ³w â€“ trzeba upewniÄ‡ siÄ™, Å¼e gdy takie zdarzenie nastÄ…pi w trakcie tury przeciwnika (np. zdobycie miasta w swojej turze), to dodatkowe PE bÄ™dÄ… dostÄ™pne od razu lub od nastÄ™pnej tury zgodnie z zaÅ‚oÅ¼eniem balansu. NajproÅ›ciej: **aktualizowaÄ‡ PE natychmiast** (co kod `capture_key_point` juÅ¼ robi). Wtedy gracz, jeÅ›li ma jeszcze moÅ¼liwoÅ›Ä‡ rekrutacji w tej turze, mÃ³gÅ‚by od razu wykorzystaÄ‡ nowo zdobyte punkty â€“ to moÅ¼e byÄ‡ nawet ciekawy element strategiczny.

5. **Zmiany w istniejÄ…cym kodzie pod system rekrutacji:**
   - W funkcji inicjalizacji Å¼etonÃ³w w `main.py` zamiast od razu dodawaÄ‡ wszystkie jednostki do paneli, moÅ¼na na starcie zaÅ‚adowaÄ‡ listÄ™ dostÄ™pnych typÃ³w (np. do pamiÄ™ci lub pozostawiÄ‡ tylko w token_index). Panel mÃ³gÅ‚by startowo byÄ‡ pusty, chyba Å¼e scenariusz przewiduje poczÄ…tkowe jednostki (wtedy te konkretne instancje naleÅ¼aÅ‚oby dodaÄ‡).
   - Trzeba usunÄ…Ä‡ ograniczenie unikalnoÅ›ci jednostek w panelu. Obecnie, jeÅ›li dany typ juÅ¼ jest w panelu, ponowne dodanie jest pomijane. To naleÅ¼y zmieniÄ‡, by **pozwoliÄ‡ na duplikaty**. JeÅ›li wybierzemy metodÄ™ kopiowania folderu, to duplikat bÄ™dzie miaÅ‚ inny `token_name` (np. dopisek (2)), wiÄ™c obecna logika nie wykryje go jako ten sam i zadziaÅ‚a bez zmian. JeÅ›li jednak zdecydowalibyÅ›my siÄ™ na identyfikacjÄ™ inaczej, naleÅ¼aÅ‚oby zmodyfikowaÄ‡ metodÄ™ `token_exists` w `TokenPanel`.
   - Warto rozszerzyÄ‡ strukturÄ™ `history` w EconomySystem o wpisy typu â€Zakup jednostki X za Y PEâ€ (co juÅ¼ bÄ™dzie dziÄ™ki parametrowi `description` w `spend_economic_points` wykorzystane). MoÅ¼na pÃ³Åºniej te informacje wykorzystaÄ‡ w podsumowaniu.

Po wprowadzeniu powyÅ¼szych zmian, system bÄ™dzie dziaÅ‚aÅ‚ nastÄ™pujÄ…co: **Gracz dysponuje pulÄ… punktÃ³w ekonomicznych, za ktÃ³re moÅ¼e rekrutowaÄ‡ nowe jednostki, ktÃ³re nastÄ™pnie pojawiajÄ… siÄ™ w jego panelu i mogÄ… zostaÄ‡ rozmieszczone na mapie, generujÄ…c odpowiednie koszty utrzymania w kolejnych turach.** DziÄ™ki temu ekonomia, zaopatrzenie i siÅ‚y zbrojne zostanÄ… zintegrowane w spÃ³jnÄ… caÅ‚oÅ›Ä‡:
- jeÅ›li gracz straci wiele jednostek, moÅ¼e wykorzystaÄ‡ zgromadzone PE na uzupeÅ‚nienia (ale zmniejszy to zasoby, ktÃ³re mÃ³gÅ‚by przeznaczyÄ‡ na zaopatrzenie istniejÄ…cych wojsk),
- jeÅ›li utrzyma punkty kluczowe i pozyska wsparcie sojusznikÃ³w, zyska przewagÄ™ ekonomicznÄ… pozwalajÄ…cÄ… wystawiÄ‡ wiÄ™cej oddziaÅ‚Ã³w,
- nadmiar posiadanych wojsk bez odpowiedniego zaopatrzenia zmusi go do konwertowania PE na PZ lub budowy dodatkowych baz, co ograniczy tempo produkcji nowych jednostek â€“ zapewni to zdrowy **dylemat strategiczny** i zapobiegnie prostemu zalewaniu mapy wojskiem bez konsekwencji logistycznych.

Wszystkie te elementy razem dadzÄ… bardziej realistyczny i zbalansowany model kampanii WrzeÅ›niowej 1939, zachowujÄ…c przy tym czytelnoÅ›Ä‡ dziÄ™ki odpowiedniemu GUI i strukturze danych.

CO DALEJ â€“ PLAN REALIZACJI (kolejne kroki)
ğŸ¯ ETAP 1: Integracja systemu ekonomii i tur
Cel: uruchomiÄ‡ dziaÅ‚anie PE/PZ i rozpoczÄ…Ä‡ Å¼ycie ekonomiczne w grze.

Kroki:

 W main.py â€“ dodaj wywoÅ‚anie economy_system.process_turn(nation) przy koÅ„cu tury (w end_turn() lub podobnym).

 ZintegrowaÄ‡ random_event() z rozpoczÄ™ciem tury.

 W update_economic_info() â€“ pokazywaÄ‡ aktualne PE, PZ i zdarzenia z historii.

 Testowo dodaÄ‡ staÅ‚y przyrost PZ (np. +300 dla Polski) w process_turn().

ğŸ› ï¸ ETAP 2: GUI konwersji PE â†’ PZ
Cel: umoÅ¼liwiÄ‡ graczowi zamianÄ™ punktÃ³w ekonomicznych na zaopatrzenie.

Kroki:

 Dodaj przycisk â€Konwertuj PE na PZâ€ w panelu ekonomicznym.

 Po klikniÄ™ciu â€“ otwÃ³rz simpledialog z wyborem liczby PE.

 WywoÅ‚aj produce_supply() i uaktualnij panel.

 Zablokuj przycisk, jeÅ›li PE za maÅ‚o.

ğŸ—ºï¸ ETAP 3: Wczytywanie i obsÅ‚uga baz
Cel: wczytaÄ‡ bazy z mapy i zasilaÄ‡ nimi jednostki.

Kroki:

 Rozszerz mapa_dane.json o sekcjÄ™ "bases" (zgodnie z analizÄ…).

 W EconomySystem dodaj load_bases(path) i uÅ¼yj go przy starcie gry.

 W calculate_maintenance() sprawdzaj bazy i ich limity.

 Na mapie â€“ narysuj bazÄ™ (np. maÅ‚y kwadrat).

ğŸª™ ETAP 4: Panel zakupu Å¼etonÃ³w
Cel: dodaÄ‡ moÅ¼liwoÅ›Ä‡ kupna jednostek za PE.

Kroki:

 Obok panelu jednostek kaÅ¼dej nacji dodaj przycisk â€Kup jednostkiâ€.

 Nowe okno: lista jednostek z katalogu tokeny/nacja/, pokazany koszt.

 Po klikniÄ™ciu â€Kupâ€:

sprawdÅº PE,

skopiuj folder jednostki,

dodaj do panelu Å¼etonÃ³w nacji,

odejmij PE.

 Zablokuj moÅ¼liwoÅ›Ä‡ kupowania, jeÅ›li tokens_locked == True.

ğŸ§° ETAP 5: Edytor map â€“ bazy zaopatrzenia
Cel: umoÅ¼liwiÄ‡ umieszczanie baz w edytorze mapy.

Kroki:

 Dodaj przycisk â€Dodaj bazÄ™â€.

 Klik na heks â†’ wybÃ³r nacji, wpisanie limitu â†’ zapis do mapy.

 Zapis i odczyt do mapa_dane.json z sekcjÄ… bases.

ğŸ§­ PRIORYTETY
JeÅ›li chcesz:

minimalnie dziaÅ‚ajÄ…cy prototyp: zrÃ³b Etap 1â€“2

peÅ‚ny model ekonomii: zrÃ³b Etap 1â€“4

peÅ‚nÄ… integracjÄ™ map i scenariuszy: zrÃ³b Etap 5

â“Decyzja:
Chcesz zaczÄ…Ä‡ od implementacji Etapu 1 (proces tury + PE/PZ + zdarzenia + raport)?
MogÄ™ od razu przygotowaÄ‡ gotowy kod do wklejenia.